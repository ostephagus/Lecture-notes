\documentclass[../Main.tex]{subfiles}

\begin{document}
\section{Defining Integration}
We are often introduced to integration as an inverse operation to differentiation. This is fine, if we know (or can guess) an antiderivative. However, this does not serve well as a definition when we can't. The idea is that the integral should be the area under a graph. We will consider the definite integral from $a$ to $b$ to be the signed area under the graph of $f(x)$. The problem with this, however, is to define such an area in terms of known concepts.\par
We first assume that $f$ is a bounded, real-valued function over the closed interval $[a, b]$. That is,
$f : [a, b] \mapsto \R$ and there exists some bound $K$ such that $|f(x)| \leq K$ for all $x$ in $[a, b]$.
\begin{definition}{Dissection}
    A \underline{Dissection}, $\dissec$, of $[a, b]$ is a finite subset of $[a, b]$ containing the endpoints $a, b$. We write $\dissec = \{x_0, x_1, \cdots, x_n\}$ with $a = x_0 < x_1 < \cdots < x_n < b$.
\end{definition}
Associated to such a dissection are the upper and lower sums given by:
\begin{equation}
    U(f, \dissec) = \sum_{j = 1}^n (x_j - x_{j - 1}) \sup_{x \in [x_{j-1}, x_j]} f(x)
    \label{eqnUpperSum}
\end{equation}
\begin{equation}
    L(f, \dissec) = \sum_{j = 1}^n (x_j - x_{j - 1}) \inf_{x \in [x_{j-1}, x_j]} f(x)
    \label{eqnLowerSum}
\end{equation}
Note that the suprema and infinima are defined here, since $f$ is bounded.\par
Clearly we have that $L(f, \dissec) \leq U(f, \dissec)$.
\begin{lemma}
    Suppose that $\dissec$ and $\dissec'$ are dissections. Suppose that $\dissec \subseteq \dissec'$. Then:
    \begin{equation*}
        L(f, \dissec) \leq L(f, \dissec') \leq U(f, \dissec') \leq U(f, \dissec)
    \end{equation*}
    \label{lemRefinement}
\end{lemma}
\begin{remark}
    In this case, where $\dissec \leq \dissec'$, we say that $\dissec'$ is a \underline{refinement} of $\dissec$.
\end{remark}
\begin{proof}
    Let $\dissec = \{x_0, \cdots, x_n\}$. First consider $\dissec' = \dissec \cup \{y\}$, where $y \notin\dissec$.\par
    Then $y \in (x_{r - 1}, x_r)$ for some $r \in \{1, \cdots, n\}$.\par
    We must have that:
    \begin{equation*}
        \sup_{x \in [x_{r - 1}, y]} f(x), \sum_{x \in [y, x_r]} f(x) \leq \sup_{x \in [x_{r - 1}, x_r]} f(x)
    \end{equation*}
    Therefore:
    \begin{align*}
        &(y - x_{r - 1}) \sup_{x \in [x_{r - 1}, y]}f(x) + (x_r - y) \sup_{x \in [y, x_r]} f(x) \\
        &\leq (y - x_{r - 1}) \sup_{x \in [x_{r - 1}, x_r]}f(x) + (x_r - y) \sup_{x \in [x_{r - 1}, x_r]} f(x) \\
        &\leq (x_r - x_{r - 1}) \sup_{x \in [x_{r - 1}, x_r]}f(x) \\
    \end{align*}
    That is, $U(f, \dissec') \leq U(f, \dissec)$.\par
    Similarly, we know that:
    \begin{equation*}
        \inf_{x \in [x_{r - 1}, y]} f(x), \inf_{x \in [y, x_r]} f(x) \geq \inf_{x \in [x_{r - 1}, x_r]} f(x)
    \end{equation*}
    and we can use the above idea to show that:
    \begin{equation*}
        L(f, \dissec) \leq L(f, \dissec')
    \end{equation*}
    Further, if there exists more than one point in $\dissec' \backslash \dissec$, we can use the result iteratively and add each point one-by-one.
\end{proof}
\begin{lemma}
    Suppose that $\dissec_1$ and $\dissec_2$ are two dissections. Then:
    \begin{equation*}
        L(f, \dissec_1) \leq U(f, \dissec_2)
    \end{equation*}
    \label{lemUpperSumAlwaysGreater}
\end{lemma}
\begin{proof}
    Consider $\dissec = \dissec_1 \cup \dissec_2$. Then this is a refinement of both $\dissec_1$ and $\dissec_2$. Using lemma~\ref{lemRefinement}:
    \begin{equation*}
        L(f, \dissec_1) \leq L(f, \dissec) \leq U(f, \dissec) \leq U(f, \dissec_2)
    \end{equation*}
\end{proof}
We have also the trivial dissection, $\dissec_0 = \{a, b\}$.
\begin{align*}
    L(f, \dissec_0) &= (b - a) \inf_{x \in [a, b]} f(x) \geq -(b - a)K \\
    U(f, \dissec_0) &= (b - a) \sup_{x \in [a, b]} f(x) \leq (b - a)K
\end{align*}
So we have that:
\begin{align*}
    \subsetselect{U(f, \dissec)}{\dissec \text{ is a dissection}} \text{ is bounded above.}\\
    \subsetselect{L(f, \dissec)}{\dissec \text{ is a dissection}} \text{ is bounded below.}
\end{align*}
Note also that, by considering the trivial dissection, neither set is empty. We can therefore take a supremum and infinimum:
\begin{definition}{Upper integral}
    The \underline{upper integral} of $f$ is:
    \begin{equation*}
        I^*(f) = \inf_{\dissec\text{ in set of dissections}} U(f, \dissec)
    \end{equation*}
\end{definition}
\begin{definition}{Lower integral}
    The \underline{lower integral} of $f$ is:
    \begin{equation*}
        I_*(f) = \sup_{\dissec\text{ in set of dissections}} L(f, \dissec)
    \end{equation*}
\end{definition}
Note that these are well-defined for any bounded function. We can also bound these in the following way by lemma~\ref{lemUpperSumAlwaysGreater}:
\begin{equation*}
    (b - a)\inf_{x \in [a, b]}f(x) \leq I_*(f) \leq I^*(f) \leq (b - a) \sup_{x \in [a, b]}f(x)
\end{equation*}
\begin{definition}{Integrable function}
    A bounded function $f : [a, b] \mapsto \R$ is \underline{Riemann integrable}, or just\\\underline{integrable}, if the lower integral of $f$ is equal to the upper integral of $f$. In this case, we define the integral to be this common limit:
    \begin{equation*}
        \int_a^b f(x) dx = I_*(f) = I^*(f)
    \end{equation*}
\end{definition}
\section{Examples of Integrable Functions}
\begin{example}
    For ease, define $\dissec_k = \{0, \frac{1}{k}, \frac{2}{k}, \cdots, 1\}$, the uniform dissection.
    $f : [0, 1] \mapsto \R, f(x) = x$.
    Then consider $U(f, \dissec_k)$:
    \begin{align*}
        U(f, \dissec_k) &= \sum_{j = 1}^k \left(\frac{j}{j} - \frac{j - 1}{k}\right) \sup_{x \in [\frac{j - 1}{k}, \frac{j}{k}]} f(x) \\
        &= \sum_{j = 1}^k \frac{1}{k} \frac{j}{k} \\
        &= \frac{1}{k^2} \frac{1}{2} k(k + 1) \\
        &= \frac{1}{2} + \frac{1}{2k}
    \end{align*}
    Similarly, the lower sum is:
    \begin{equation*}
        L(f, \dissec_k) = \frac{1}{2} - \frac{1}{2k}
    \end{equation*}
    We deduce that the upper integral is bounded above by the infinimum over $k$ of the upper sums. This is $\frac{1}{2}$. Further, the lower integral is bounded below by the supremum over $k$ of the lower sum. This is $\frac{1}{2}$. Now, by the inequalities already established, the upper and lower integrals must both be $\frac{1}{2}$.
\end{example}
\begin{example}
    Consider now the function:
    \begin{align*}
        f : [0, 1] &\mapsto \R \\
        x &\mapsto
        \begin{cases}
            1 & x \in \Q \\
            0 & x \notin \Q 
        \end{cases}
    \end{align*}
    $f$ is not integrable. For any $\dissec$, every upper sum gives $1$ (there is always a rational number between any two real numbers), and every lower sum gives $0$ (there is always an irrational number between two real numbers). Therefore, $I^* = 1$ and $I_* = 0$.
\end{example}
\section{Integrability of General Functions}
\begin{theorem}[Riemann's Integrability Criterion]
    A bounded function $f : [a, b] \mapsto \R$ is integrable if and only if for all $\epsilon > 0$, there exists a dissection $\dissec$ such that:
    \begin{equation*}
        U(f, \dissec) - L(f, \dissec) < \epsilon
    \end{equation*}
    \label{thmRiemannCriterion}
\end{theorem}
\begin{proof}
    \begin{proofdirection}{$\Rightarrow$}{Assume that there exist $U(f, \dissec) - L(f, \dissec) < \epsilon$}
        For any dissection $\dissec$, we have that:
        \begin{equation*}
            0 \leq I^*(f) - I_*(f) \leq U(f, \dissec) - L(f, \dissec)
        \end{equation*}
        Now we have the following bound:
        \begin{equation*}
            0 \leq I^*(f) - I_*(f) < \epsilon
        \end{equation*}
        And since $\epsilon$ is arbitrary, we must have that $I^*(f) = I_*(f)$, and $f$ is integrable.
    \end{proofdirection}
    \begin{proofdirection}{$\Leftarrow$}{Assume that $f$ is integrable.}
        Then for any $\epsilon$, there exist $\dissec_1, \dissec_2$ such that:
        \begin{align*}
            U(f, \dissec_1) &\leq I^*(f) + \frac{\epsilon}{2} \\
            L(f, \dissec_2) &\geq I_*(f) - \frac{\epsilon}{2}
        \end{align*}
        Therefore consider $\dissec = \dissec_1 \cup \dissec_2$. Therefore, by lemma~\ref{lemRefinement}
        \begin{align*}
            U(f, \dissec) &\leq U(f, \dissec_1) \\
            L(f, \dissec) &\geq L(f, \dissec_2)
        \end{align*}
        Which implies:
        \begin{align*}
            0 \leq U(f, \dissec) - L(f, \dissec) &\leq U(f, \dissec_1) - L(f, \dissec_2) \\
            &\leq I^*(f) - I_*(f) + \epsilon \\
            &= \epsilon
        \end{align*}
    \end{proofdirection}
\end{proof}
We can use this criterion to show that all monotone and all continuous functions are integrable.

\begin{remark}
    If $f : [a, b] \mapsto \R$ is monotone then it is bounded by its values at the endpoints. If $f$ is continuous, we can use theorem~\ref{thmExtremeValue} to show that it also is bounded.
\end{remark}
\begin{theorem}
    Suppose $f : [a, b] \mapsto \R$ is monotone. Then $f$ is integrable.
\end{theorem}
\begin{proof}
    If $f$ is decreasing, re-label $-f$ to be $f$. Therefore assume WLOG that $f$ is increasing.
    
    For any given dissection $\dissec$,
    \begin{align*}
        \sup_{x \in [x_{j-1}, x_j]} f(x) &= f(x_j) \\
        \inf_{x \in [x_{j-1}, x_j]} f(x) &= f(x_{j-1}) 
    \end{align*}
    Therefore:
    \begin{align*}
        U(f, \dissec) - L(f, \dissec) &= \sum_{j = 1}^n (x_j - x_{j - 1}) \sup_{x \in [x_{j-1}, x_j]} f(x) \\
        &- \sum_{j = 1}^n (x_j - x_{j - 1}) \inf_{x \in [x_{j-1}, x_j]} f(x) \\
        &= \sum_{j = 1}^n (x_j - x_{j - 1}) \left[f(x_j) - f(x_{j - 1})\right]
    \end{align*}
    Then choose the uniform dissection $\dissec_n$ into $n$ equal-length intervals. This gives:
    \begin{align*}
        U(f, &\dissec_n) - L(f, \dissec_n) \\
        &= \sum_{j = 1}^n \left(\frac{b - a}{n}\right) \left[f\left(a + \frac{j(b - a)}{n}\right) - f\left(a + \frac{(j - 1)(b - a)}{n}\right)\right] \\
        &= \frac{b - a}{n} \left[f(b) - f(a)\right] \text{ by telescoping series}
    \end{align*}
    Therefore, taking $n$ sufficiently large we have that this difference can be smaller than any given $\epsilon$. Therefore, by theorem~\ref{thmRiemannCriterion}, $f$ is integrable.
\end{proof}
\begin{theorem}
    Suppose $f : [a, b] \mapsto \R$ is continuous. Then $f$ is integrable.
\end{theorem}
\begin{proof}
    We prove the contrapositive. That is, if $f$ is not integrable then it must be discontinuous.

    Suppose $f$ is not integrable. Therefore, by theorem~\ref{thmRiemannCriterion}, there must exist some $\epsilon_0 > 0$ such that for any dissection $\dissec$, we have that:
    \begin{equation*}
        U(f, \dissec) - L(f, \dissec) > \epsilon_0
    \end{equation*}
    We also know that
    \begin{equation*}
        U(f, \dissec) - L(f, \dissec) = \sum_{j = 1}^n (x_j - x_{j - 1})\left[\sup_{x \in [x_{j-1}, x_j]} f(x) - \inf_{x \in [x_{j-1}, x_j]} f(x)\right]
    \end{equation*}
    It therefore follows that for any dissection there exists a $j$ with:
    \begin{equation*}
        \sup_{x \in [x_{j-1}, x_j]} f(x) - \inf_{x \in [x_{j-1}, x_j]} f(x) > \frac{\epsilon_0}{b - a}
    \end{equation*}
    since otherwise the sum cannot be greater than $\epsilon_0$.

    Now let $\dissec_n$ be the uniform dissection of $n$ equal-length intervals. And therefore we have a sub-interval with:
    \begin{equation*}
        \sup_{x \in [a + (j-1)(b-a)/n, a + j(b-1)/n]} f(x) - \inf_{x \in [a + (j-1)(b-a)/n, a + j(b-1)/n]} < \frac{\epsilon_0}{b - a}
    \end{equation*}
    And we deduce that there exist $y_n, z_n$ in the same interval (which gives $|y_n - z_n| \leq \frac{b - a}{n}$) such that:
    \begin{equation}
        f(y_n) - f(z_n) > \frac{\epsilon_0}{b - a}
        \label{eqnFOfSequenceFarApart}
    \end{equation}
    Note also that $(y_n)$ is a bounded sequence and by theorem~\ref{thmBolzanoWeierstrass}, we can extract a convergent subsequence $y_{n_k} \to \eta$ for $\eta \in [a, b]$.

    However, we also know that $|y_{n_k} - z_{n_k}| \leq \frac{b-a}{n_k} \to 0$ as $k \to \infty$, so we must also have that $z_{n_k} \to \eta$. However, the bound in equation~\ref{eqnFOfSequenceFarApart} implies that $f(y_n)$ and $f(z_n)$ do not tend to the same limit. Thus, by theorem~\ref{thmContinuitySequenceDef}, $f$ must be discontinuous at $\eta$.
\end{proof}
\begin{remark}
    With monotone and continuous functions, we have that a large class of functions are integrable. However, there do exist functions outside these classes that are integrable.
\end{remark}
\begin{example}[Thomae's Function]
    Define:
    \begin{align*}
        f : [0, 1] &\mapsto \R \\
        x &\mapsto
        \begin{cases}
            \frac{1}{q} & x = \frac{p}{q} \text{ where } p, q \text{ coprime} \\
            0 & x \notin \Q
        \end{cases}
    \end{align*}
    Then we show that $f$ is integrable. Clearly for any $\dissec, L(f, \dissec) = 0$, so it is sufficient to show that we can find a $\dissec$ with $U(f, \dissec) < \epsilon$.

    Given $\epsilon > 0$, choose $N \in \N$ such that $\frac{1}{N} < \frac{\epsilon}{2}$. Consider:
    \begin{equation*}
        P = \subsetselect{x \in [0, 1]}{f(x) \geq \frac{1}{N}} \subseteq \subsetselect{\frac{p, q}}{1 \leq p, q \leq N}
    \end{equation*}
    Then this is a finite set. Define $P = \{p_1, p_2, \cdots, p_m\}$ and order the $p_i$ to be increasing with $i$. Then choose a dissection $\dissec$ that satisfies the following properties:
    \begin{enumerate}
        \item Each $p_k$ is in some interval $(x_{j - 1}, x_j)$.
        \item For each $k$, the unique sub-interval containing $p_k$ has length at most $\frac{\epsilon}{2m}$.
    \end{enumerate}
    Write $I \in \dissec$ to mean $I = [x_{j-1}, x_j]$ for some $j$. Write also $|I| = (x_j - x_{j-1})$.

    Then the upper sum is:
    \begin{align*}
        U(f, \dissec) &= \sum_{I \in \dissec} |I| \sup_{x \in I} f(x) \\
        &= \sum_{I \in \dissec, I \cap P \neq \emptyset} |I| \sup_{x \in I} f(x) \sum_{I \in \dissec, I \cap P = \emptyset} |I| \sup_{x \in I} f(x) \\
        &\leq \sum_{I \in \dissec, I \cap P \neq \emptyset} \frac{\epsilon}{2M} + \sum_{I \in \dissec, I \cap P \neq \emptyset} \frac{|I|}{N} \\
        &\leq M \frac{\epsilon}{2M} + \frac{1}{N} < \epsilon
    \end{align*}
\end{example}
\begin{remark}
    We have seen that Thomae's Function is an integrable function that has discontinuities (it is continuous at every irrational, but discontinuous at every rational) and is not monotone.
\end{remark}
\section{Properties of the Integral}
\subsection{Properties of Suprema and Infinima}
\begin{propositions}{
        Suppose that $I = [a, b]$ and $f, g : I \mapsto \R$ are bounded. Then:
        \label{propsSupremumProps}
    }   
    \item If $f(x) \leq g(x)~\forall x \in I$, then
        \begin{equation*}
            \sup_{x \in I} f(x) \leq \sup_{x \in I} g(x) \text{ and } \inf_{x \in I} f(x) \leq \inf_{x \in I} g(x)
        \end{equation*}
        \label{propSupPreservesOrdering}
    \item $\sup_{x \in I} f(x) = -\inf_{x \in I} f(x)$. \label{propSupOfNegative}
    \item If $\lambda > 0$, then:
        \begin{equation*}
            \sup_{x \in I} \lambda f(x) = \lambda \sup_{x \in I} f(x) \text{ and } \sup_{x \in I} \lambda f(x) = \lambda \sup_{x \in I} f(x)
        \end{equation*}
        \label{propSupConstant}
    \item Summation:
        \begin{align*}
            \sup_{x \in I} (f(x) + g(x)) &\leq \sup_{x \in I} f(x) + \sup_{x \in I} g(x) \\
            \inf{x \in I} (f(x) + g(x)) &\geq \inf{x \in I} f(x) + \inf{x \in I} g(x) \\
        \end{align*}
        \label{propSupSum}
    \item Taking absolute values:
        \begin{equation*}
            \sup_{x \in I} |f(x)| - \inf_{x \in I} |f(x)| \leq \sup_{x \in I} f(x) - \inf_{x \in I} f(x)
        \end{equation*}
        \label{propSupAbs}
    \item Squaring:
        \begin{equation*}
            \sup_{x \in I} (f(x))^2 - \inf_{x \in I} (f(x))^2 \leq 2 \left(\sup_{x \in I} |f|\right) \left(\sup_{x \in I} f(x) - \inf_{x \in I} f(x) \right)
        \end{equation*}
        \label{propSupSquare}
\end{propositions}
\begin{proof}[of propositions~\ref{propSupSum} to \ref{propSupSquare}]
    \begin{enumerate}
        \setcounter{enumi}{3} % Start at 4
        \item For any $x \in I$,
            \begin{equation*}
                f(x) \leq \sup_{x \in I} f(x),~g(x) \leq \sup_{x \in I} g(x)
            \end{equation*}
            So:
            \begin{equation*}
                f(x) + g(x) \leq \sup_{x \in I} f(x) + \sup_{x \in I} g(x)
            \end{equation*}
            But this means we can take the supremum of the LHS:
            \begin{equation*}
                \sup_{x \in I} (f(x) + g(x)) \leq \sup_{x \in I} f(x) + \sup_{x \in I} g(x)
            \end{equation*}
            And the same method is used for infima. Alternatively, we can apply proposition~\ref{propSupOfNegative} to $-(f + g)$.
        \item We consider 3 cases:
            \begin{case}{$f(x)$ non-negative on $I$}
                Then $|f(x)| = f(x)$:
                \begin{equation*}
                    \sup_{x \in I} |f(x)| - \inf_{x \in I} |f(x)| = \sup_{x \in I} f(x) - \inf_{x \in I} f(x)
                \end{equation*}
            \end{case}
            \begin{case}{$f(x)$ non-positive on $I$}
                Then $|f(x)| = -f(x)$.
                \begin{align*}
                    \sup_{x \in I} |f(x)| - \inf_{x \in I} |f(x)| &= \sup_{x \in I} (-f(x)) - \inf_{x \in I} (-f(x)) \\
                    &= -\inf_{x \in I} f(x) + \sup_{x \in I} f(x)
               \end{align*}
            \end{case}
            \begin{case}{$f(x)$ takes values either side of 0}
                That is, $\inf_{x \in I} f(x) < 0 < \sup_{x \in I} f(x)$.
                \begin{align*}
                    \sup_{x \in I} |f(x)| - \inf_{x \in I} |f(x)| &\leq \sup_{x \in I} |f(x)| \text{ by negativity of inf.} \\
                    &= \max\{\sup_{x \in I} f(x), \sup_{x \in I} (-f(x))\} \\
                    &\leq \sup_{x \in I} f(x) + \sup_{x \in I} (-f(x)) \\
                    &= \sup_{x \in I} f(x) - \inf_{x \in I} f(x)
                \end{align*}
            \end{case}
        \item Consider difference of squares:
            \begin{align*}
                f(x)^2 - f(y)^2 &= (f(x) + f(y))(f(x) - f(y)) \\
                &\leq 2\sup_{x \in I} |f| \left(\sup_{x \in I} f(x) - \inf_{x \in I} f(x)\right)
            \end{align*}
            Then taking the supremum over $x$ and $y$ of the left-hand side gives:
            \begin{equation*}
                \sup_{x \in I}(f(x)^2) + \inf_{x \in I} (f(x)^2) \leq 2 \sup_{x \in I} |f| \left(\sup_{x \in I} f(x) - \inf_{x \in I} f(x)\right)
            \end{equation*}
    \end{enumerate}
\end{proof}
\subsection{Properties of Upper and Lower Sums}
These translate directly into results for upper and lower sums:
\begin{propositions}{
        Consider a dissection $\dissec$ and bounded functions $f, g : [a, b] \mapsto \R$.
        \label{propsUpperSumProps}
    }
    \item If $f(x) \leq g(x)$ for all $x$ in $[a, b]$ then:
        \begin{equation*}
            U(f, \dissec) \leq U(g, \dissec) \text{ and } L(f, \dissec) \leq L(g, \dissec)
        \end{equation*}
        \label{propupperSumPreservesOrdering}
    \item $L(-f, \dissec) = -U(f, \dissec)$. \label{propUpperSumNegative}
    \item If $\lambda \in \R, \lambda > 0$,
        \begin{equation*}
            U(\lambda f, \dissec) = \lambda U(f, \dissec) \text{ and } L(\lambda f, \dissec) = \lambda L(f, \dissec)
        \end{equation*}
        \label{propUpperSumConstant}
    \item Summation is such that:
        \begin{align*}
            U(f + g, \dissec) &\leq U(f, \dissec) + U(g, \dissec) \\
            U(f + g, \dissec) &\geq L(f, \dissec) + L(g, \dissec)
        \end{align*}
        \label{propUpperSumSum}
    \item Absolute values are such that:
        \begin{equation*}
            U(|f|, \dissec) - L(|f|, \dissec) \leq U(f, \dissec) - L(f, \dissec)
        \end{equation*}
        \label{propUpperSumAbs}
    \item Squaring is such that:
        \begin{equation*}
            U(f^2, \dissec) - L(f^2, \dissec) \leq 2\sup_{x \in [a, b]} |f| \left(U(f, \dissec) - L(f, \dissec)\right)
        \end{equation*}
        \label{propUpperSumSquare}
\end{propositions}
\begin{proof}
    Recall that:
    \begin{align*}
        U(f, \dissec) &= \sum_{i = 1}^n \left(x_i - x_{i - 1}\right) \sup_{x \in [x_{i - 1}, x_i]} f(x) \\
        L(f, \dissec) &= \sum_{i = 1}^n \left(x_i - x_{i - 1}\right) \inf_{x \in [x_{i - 1}, x_i]} f(x)
    \end{align*}
    And use the results in proposition~\ref{propsSupremumProps}, noting also that:
    \begin{equation*}
        \sup_{x \in [x_{i - 1}, x_i]} |f(x)| \leq \sup_{x \in [a, b]} |f(x)|
    \end{equation*}
    for use in the proof of \ref{propUpperSumSquare}.
\end{proof}
\subsection{Integral properties}
\begin{theorem}
    Let $f, g : [a, b] \mapsto \R$ be integrable (and therefore bounded).
    \begin{enumerate}
        \item If $f(x) \leq g(x)$ on $[a, b]$, then:
	    \begin{equation*}
		\int_a^b f(x) dx \leq \int_a^b g(x) dx
	    \end{equation*}
	\item If $\lambda$ is a real number then $\lambda f$ is integrable, and:
	    \begin{equation*}
		\int_a^b \lambda f(x) dx = \lambda \int_a^b f(x) dx
	    \end{equation*}
	\item $f + g$ is integrable, and:
	    \begin{equation*}
		\int_a^b (f(x) + g(x)) dx = \int_a^b f(x) dx + \int_a^b g(x) dx
	    \end{equation*}
	\item $|f|$ is integrable, and:
	    \begin{equation*}
		\left|\int_a^b f(x) dx\right| \leq \int_a^b |f(x)| dx
	    \end{equation*}
	\item The product $f(x) g(x)$ is integrable.
    \end{enumerate}
\end{theorem}
\begin{proof}
    \begin{enumerate}
    	\item For any $\dissec$ we have:
            \begin{align*}
                L(f, \dissec) &\leq L(g, \dissec) \text{ by proposition~\ref{propupperSumPreservesOrdering}} \\
                &\leq I_*(g) \\
                \therefore I_*(f) &\leq I_*(g)
            \end{align*}
            But since $f$ and $g$ are integrable, the lower integrals are equal to the integral, and we have the required result.
        \item First consider $\lambda > 0$. Since $f$ is integrable, for any $\epsilon > 0$ there exists a dissection $\dissec$ with:
            \begin{align*}
                U(f, \dissec) &\leq \int_a^b f(x) + \epsilon \\
                L(f, \dissec) &\geq \int_a^b f(x) - \epsilon
            \end{align*}
            And therefore:
            \begin{align*}
                \lambda \int_a^b f(x) dx - \lambda \epsilon &\leq L(\lambda f, \dissec) \text{by \ref{propUpperSumConstant}.} \\
                &\leq I_*(f) \\
                &\leq I^*(f) \\
                &\leq U(\lambda f, \dissec) \\
                &\leq \lambda \int_a^b f(x) dx + \lambda \epsilon \text{ by \ref{propUpperSumConstant}}
            \end{align*}
            But now, since $\epsilon$ is arbitrary:
            \begin{equation*}
                I_*(\lambda f) = I^*(\lambda f) = \lambda \int_a^b f(x) dx
            \end{equation*}
            Now we consider $\lambda = -1$ and the same dissection $\dissec$:
            \begin{align*}
                \int_a^b f(x) dx - \epsilon &\leq L(f, \dissec) \\
                &= -U(-f, \dissec) \text{ by \ref{propUpperSumNegative}}
            \end{align*}
            And therefore:
            \begin{equation*}
                U(-f, \dissec) \leq -\int_a^b f(x) dx + \epsilon
            \end{equation*}
            And:
            \begin{align*}
                \int_a^b f(x) dx + \epsilon &\geq U(f, \dissec) \\
                &= -L(-f, \dissec) \\
                \therefore -\int_a^b f(x) dx - \epsilon &\leq L(-f, \dissec)
            \end{align*}
            Then combining both results:
            \begin{equation*}
                -\int_a^b f(x) dx - \epsilon \leq I_*(-f) \leq I^*(-f) \leq -\int_a^b f(x) dx + \epsilon
            \end{equation*}
            And again we have that $\epsilon$ is arbitrary and so:
            \begin{equation*}
                I_*(-f) = I^*(-f) = -\int_a^b f(x) dx
            \end{equation*}
            Combining both these results allows for negative $\lambda$ also.
        \item Since $f$ and $g$ are integrable, for any $\epsilon > 0$ there exists dissections $\dissec_1, \dissec_2$ such that:
            \begin{align*}
                \int_a^b f(x) dx - \epsilon &\leq L(f, \dissec_1) \\
                &\leq U(f, \dissec_1) \\
                &\leq \int_a^b f(x) dx + \epsilon
            \end{align*}
            And the same for $g$:
            \begin{align*}
                \int_a^b g(x) dx - \epsilon &\leq L(g, \dissec_2) \\
                &\leq U(g, \dissec_2) \\
                &\leq \int_a^b g(x) dx + \epsilon
            \end{align*}
            Now define $\dissec = \dissec_1 \cup \dissec_2$:
            \begin{align*}
                \int_a^b f(x) dx + \int_a^b g(x) dx - 2\epsilon &\leq L(f, \dissec_1) + L(g, \dissec_2) \\
                &\leq L(f, \dissec) + L(g, \dissec) \\
                &\leq L(f + g, \dissec) \text{ by \ref{propUpperSumSum}.} \\
                &\leq I_*(f + g)
            \end{align*}
            And similarly:
            \begin{equation*}
                \int_a^b f(x) dx + \int_a^b g(x) + 2\epsilon dx \geq I^*(f + g)
            \end{equation*}
            So we have shown:
            \begin{align*}
                \int_a^b f(x) dx &+ \int_a^b g(x) dx - 2\epsilon \leq I_*(f + g)\\
                &\leq I^*(f + g) \leq \int_a^b f(x) dx + \int_a^b g(x) dx + 2\epsilon
            \end{align*}
            And since $\epsilon$ is arbitrary, $f + g$ is integrable with integral:
            \begin{equation*}
                \int_a^b f(x) dx + \int_a^b g(x) dx = \int_a^b (f(x) + g(x)) dx
            \end{equation*}
        \item Since $f$ is integrable, for any $\epsilon > 0$ there exists a dissection $\dissec$ such that:
            \begin{align*}
                \epsilon &> U(f, \dissec) - L(f, \dissec) \\
                &\leq U(|f|, \dissec) - L(|f|, \dissec) \text{ by proposition~\ref{propUpperSumAbs}}
            \end{align*}
            And therefore $|f|$ is integrable by theorem~\ref{thmRiemannCriterion}.

            Now note that:
            \begin{align*}
                -|f(x) &\leq f(x) \leq |f(x)|~\forall x \in [a, b] \\
                \implies -\int_a^b |f(x)| &\leq \int_a^b f(x) dx \leq \int_a^b |f(x)| dx
            \end{align*}
            by parts 1 and 2 above, as required.
        \item Observing that:
            \begin{equation*}
                fg = \frac{1}{2} \left[(f + g)^2 - (f - g)^2\right]
            \end{equation*}
            it suffices to show that $f^2$ is integrable (and therefore so is $g^2$).

            Suppose $|f| \leq K$. Then given $\epsilon > 0$ we can find a dissection such that:
            \begin{equation*}
                U(f, \dissec) - L(f, \dissec) < \frac{\epsilon}{2K}
            \end{equation*}
            So by proposition~\ref{propUpperSumSquare},
            \begin{align*}
                U(f^2, \dissec) - L(f^2, \dissec) &\leq 2 \sup_{x \in [a, b]} |f(x)| \left(U(f, \dissec) - L(f, \dissec)\right) \\
                &<\epsilon
            \end{align*}
            And therefore $f^2$ is integrable by theorem~\ref{thmRiemannCriterion}.
    \end{enumerate}
\end{proof}
\begin{theorem}
    Suppose that $f : [a, b] \mapsto \R$ and let $c \in (a, b)$. Then $f$ is integrable if and only if $f$ is integrable on $[a, c]$ and $[c, b]$. Moreover, we can relate these integrals:
    \begin{equation*}
        \int_a^b f(x) dx = \int_a^c f(x) dx + \int_c^b f(x) dx
    \end{equation*}
    \label{thmIntegralSplitDomain}
\end{theorem}
\begin{proof}
    \begin{proofdirection}{$\Rightarrow$}{Suppose $f$ is integrable on $[a, b]$}
        Fix $\epsilon > 0$. By theorem~\ref{thmRiemannCriterion} there exists a dissection $\dissec$ of $[a, b]$ such that:
        \begin{equation*}
            U(f, \dissec) - L(f, \dissec) < \epsilon.
        \end{equation*}
        If $c$ is not in $\dissec$, re-label $\dissec$ to $\dissec \cup \{c\}$. Note that this is a refinement, so the difference in upper and lower sums is still less than $\epsilon$.

        Now assume $\dissec = \{x_0, x_1, \cdots, x_n\}$ and $x_l = c$.

        Define:
        \begin{equation*}
            \dissec_L = \{x_0, x_1, \cdots, x_l\},~\dissec_R = \{x_l, x_{l + 1}, \cdots, x_n\}
        \end{equation*}
        Then $\dissec_L$ is a dissection of $[a, c]$ and $\dissec_R$ is a dissection of $[c, b]$.

        Note also that:
        \begin{align*}
            L(f, \dissec) &= L(f, \dissec_L) + L(f, \dissec_R) \\
            R(f, \dissec) &= R(f, \dissec_L) + R(f, \dissec_R)
        \end{align*}
        And therefore:
        \begin{equation*}
            \left[U(f, \dissec_L) - L(f, \dissec_L)\right] + \left[U(f, \dissec_R) - L(f, \dissec_R)\right] < \epsilon
        \end{equation*}
        Note that both terms in square brackets are non-negative so we must have that both are less than $\epsilon$:
        \begin{align*}
            U(f, \dissec_L) - L(f, \dissec_L) &< \epsilon \\
            U(f, \dissec_R) - L(f, \dissec_R) &< \epsilon
        \end{align*}
        And therefore $f$ is integral on both domains.
    \end{proofdirection}
    \begin{proofdirection}{$\Leftarrow$}{Suppose that $f$ is integrable on $[a, c]$ and $[c, b]$}
        Fix $\epsilon > 0$. Then by theorem~\ref{thmRiemannCriterion}, there are dissection $\dissec_L, \dissec_R$ of the respective intervals such that the following holds:
        \begin{align*}
            U(f, \dissec_L) - L(f, \dissec_L) &< \epsilon \\
            U(f, \dissec_R) - L(f, \dissec_R) &< \epsilon
        \end{align*}
        Then considering the dissection $\dissec = \dissec_L \cup \dissec_R$:
        \begin{equation*}
            U(f, \dissec) - L(f, \dissec) < 2\epsilon
        \end{equation*}
        And by the Riemann Criterion, $f$ is integrable on the whole of $[a, b]$.
    \end{proofdirection}
    Finally note that, by the above,
    \begin{align*}
        \int_a^b f(x) dx &\geq L(f, \dissec) = L(f, \dissec_L) + L(f, \dissec_R) \\
        &\geq \int_a^c f(x) dx + \int_c^b f(x) dx - 2\epsilon
    \end{align*}
    And also:
    \begin{align*}
        \int_a^b f(x) dx &\leq U(f, \dissec) = U(f, \dissec_L) + U(f, \dissec_R) \\
        &\leq \int_a^c f(x) dx + \int_c^b f(x) dx + 2\epsilon
    \end{align*}
    And since $\epsilon$ was arbitrary, we have the required result.
\end{proof}
From now on, we will use the convention that:
\begin{equation*}
    \int_a^b f(x) dx = -\int_b^a f(x) dx
\end{equation*}
And also if $a - b$, then the integral is 0. With this convention, if $|f| \leq K$,
\begin{equation*}
    \left|\int_a^b f(x) dx\right| \leq K|b - a|
\end{equation*}
\section{Piecewise Continuous Functions}
\begin{definition}{Piecewise continuity}
    A bounded function $f : [a, b] \mapsto \R$ is \underline{piecewise continuous} if there exists a dissection $\dissec$ of $[a, b]$ such that for each $i \in \{1, \cdots, n\}$, if we define:
    \begin{align*}
        f_i : (x_{i - 1}, x_i) &\mapsto \R \\
        x \mapsto f(x)
    \end{align*}
    Then $f_i$ is continuous and has a limit as $x \to x_{i - 1}$ or as $x \to x_i$. This means that the function $\bar{f}_i : [x_{i-1}, x_i] \mapsto \R$, defined by:
    \begin{equation*}
        \bar{f}_i(x) =
        \begin{cases}
            \lim_{x \to x_{i - 1}} f_i(x) & x = x_{i - 1} \\
            f(x) & x \in (x_{i - 1}, x_i) \\
            \lim_{x \to x_i} f_i(x) & x = x_i
        \end{cases}
    \end{equation*}
    is continuous, and therefore integrable.
\end{definition}
\begin{proposition}
    If $f : [a, b] \mapsto \R$ is integrable and $f : [a, b] \mapsto \R$ satisfies $f(x) = g(x)$ for all $x$ except a finite set of points $\{y_1, \cdots, y_n\}$, then $g$ is integrable with:
    \begin{equation*}
        \int_a^b f(x) dx = \int_a^b g(x) dx
    \end{equation*}
    \label{propChangeFinitePointsIntegrable}
\end{proposition}
Now by combining theorem~\ref{thmIntegralSplitDomain} with proposition~\ref{propChangeFinitePointsIntegrable}, we see that piecewise continuous function are integrable.
\section{Fundamental Theorem of Calculus}
Suppose $f : [a, b] \mapsto \R$ is integrable (and therefore bounded). Then define:
\begin{equation*}
    F(x) = \int_a^x f(t) dt
\end{equation*}
for any $x \in [a, b]$.
\begin{theorem}
    $F$, as above defined, is continuous.
    \label{thmIntegralCTS}
\end{theorem}
\begin{proof}
    Suppose $K$ is such that $|f| \leq K$, and assume $x, x+h \in [a, b]$. Then:
    \begin{align*}
        F(x + h) - F(x) &= \int_x^{x + h} f(x) dt \text{ by theorem~\ref{thmIntegralSplitDomain}.} \\
        \left|F(x + h) - F(x)\right| &= \left|\int_x^{x + h} f(x) dt\right| \\
        &\leq K|h|
    \end{align*}
    And as $h \to 0$, $F(x + h) - F(x)$ tends to $0$ and $F$ is continuous at all $x$.
\end{proof}
\begin{theorem}[First Fundamental Theorem of Calculus]
    If, in addition, $f$ is continuous at $x$, then $F$ is differentiable at $x$ and has derivative:
    \begin{equation*}
        F'(x) = f(x)
    \end{equation*}
    \label{thmFundamentalCalculusI}
\end{theorem}
\begin{proof}
    We need to estimate the difference quotient:
    \begin{equation*}
        \left|\frac{F(x + h) - F(x)}{h} - f(x)\right|
    \end{equation*}
    We want to show it tends to $0$ as $h \to 0$.

    \begin{align*}
        \left|\frac{F(x + h) - F(x)}{h} - f(x)\right| &= \frac{1}{|h|} \left|\int_x^{x + h} f(t) dt - hf(x)\right| \\
        &= \frac{1}{|h|} \left|\int_x^{x + h} (f(t) - f(x))dt\right|
    \end{align*}
    Now, given $\epsilon > 0$, there exists some $\delta > 0$ such that:
    \begin{equation*}
        |t - x| < \delta \implies |f(t) - f(x) < \epsilon
    \end{equation*}
    Now suppose $|h| < \delta$, then $|f(t) - f(x)| < \epsilon$ for all $t$ between $x$ and $x + h$.
    \begin{align*}
        \therefore \left|\frac{F(x + h) - F(x)}{h} - f(x)\right| &\leq \frac{1}{|h|} \epsilon h \\
        &= \epsilon
    \end{align*}
    And therefore the difference quotient must tend to 0.
\end{proof}
\begin{remark}
    The condition that $f$ is continuous at $x$ is necessary. If we consider instead a step function:
    \begin{equation*}
        f(x) = 
        \begin{cases}
            -1 & x \in [-1, 0] \\
            1 & x \in (0, 1] \\
        \end{cases}
    \end{equation*}
    Then we can find a function $F$:
    \begin{equation*}
        F(x) =
        \begin{cases}
            -x - 1 & x \leq 0 \\
            x - 1 & x > 0
        \end{cases}
    \end{equation*}
    Then this function is not differentiable at $x = 0$, though it is continuous there.
\end{remark}
\begin{corollary}[Integration as inverse of differentiation]
    If $f = g'$ and $g'$ is continuous on an interval $[a, b]$, then:
    \begin{equation*}
        F(x) = \int_a^x f(t) dt = g(x) - g(a)
    \end{equation*}
    \label{corIntegrationInverseDifferentiation}
\end{corollary}
\begin{proof}
    Consider:
    \begin{equation*}
        \int_a^x f(t) dt - g(x) = G(x)
    \end{equation*}
    Then this is differentiable and $G'(x) = 0$ for all $x \in [a, b]$. So by corollary~\ref{corDerivativeSign},
    \begin{equation*}
        G(x) = G(a) = -g(a)
    \end{equation*}
    And rearranging gives the required result.
\end{proof}
\begin{corollary}
    Every continuous function $f$ has a corresponding antiderivative $F$, written:
    \begin{equation*}
        \int f(x) dx \text{ or } \int^x f(t) dt
    \end{equation*}
    That is, an integral with no limits (or no lower limit). This is determined up to an additive constant.
\end{corollary}
\begin{remark}
    The conclusions of corollary~\ref{corIntegrationInverseDifferentiation} hold under slightly weaker assumptions. See the next theorem
\end{remark}
\begin{theorem}[Second Fundamental Theorem of Calculus]
    Suppose $f : [a, b] \mapsto \R$ is continuous on $[a, b]$, differentiable on $(a, b)$ and that $f'$ is integrable. Then:
    \begin{equation*}
        \int_a^b f'(x) dx = f(b) - f(a)
    \end{equation*}
    \label{thmFundamentalCalculusII}
\end{theorem}
\begin{proof}
    Let $\dissec$ be any dissection of the interval $[a, b]$. Applying the Mean Value Theorem to a sub-interval $[x_{i - 1}, x_i]$, we deduce that there exists some $\xi_i \in (x_{i - 1}, x_i)$ such that:
    \begin{equation*}
        f'(\xi_i)(x_i - x_{i - 1}) = f(x_i) - f(x_{i - 1})
    \end{equation*}
    Then summing:
    \begin{equation*}
        \sum_{i = 1}^n f'(\xi_i)(x_i - x_{i - 1}) = f(b) - f(a)
    \end{equation*}
    But:
    \begin{align*}
        (x_i - x_{i - 1}) \inf_{x \in [x_{i - 1}, x_i]} f'(x) &\leq \sum_{i = 1}^n f'(\xi_i) (x_i - x_{i - 1}) \\
        &\leq \sum_{i = 1}^n (x_i - x_{i - 1}) \sup_{x \in [x_{i - 1}, x_i]} f'(x)
    \end{align*}
    Which means:
    \begin{align*}
        &L(f', \dissec) \leq f(b) - f(a) \leq U(f', \dissec) \\
        \implies &I_*(f') \leq f(b) - f(a) \leq I^*(f')
    \end{align*}
    But $f'$ is integrable so $I_*(f') = I^*(f') = f(b) - f(a)$.
\end{proof}
\begin{remark}
    The assumption that $f'$ is integrable is necessary. Consider:
    \begin{align*}
        f: [-1, 1] &\mapsto \R \\
        x &\mapsto
        \begin{cases}
            |x|^{\frac{3}{2}} \sin\frac{1}{x} & x \neq 0 \\
            0 & x = 0
        \end{cases}
    \end{align*}
    $f$ is continuous on $[-1, 1]$, differentiable on $(-1, 1)$, but $f'$ is unbounded and hence not integrable.
\end{remark}
Another important corollary of the first fundamental theorem of calculus (theorem~\ref{thmFundamentalCalculusI}) is:
\begin{corollary}[Integration by parts]
    Suppose that $f'$ and $g'$ exist and are continuous on $[a, b]$. Then:
    \begin{equation*}
        \int_a^b f'(x) g(x) dx = f(b) g(b) - f(a) g(a) - \int_a^b f(x) g'(x) dx
    \end{equation*}
    \label{corIntegrationParts}
\end{corollary}
\begin{proof}
    \begin{align*}
        \int_a^b f'(x) g(x) dx &= \int_a^b ((fg)'(x) - g'(x) f(x))dx \text{ by product rule} \\
        &= \int_a^b (fg)'(x) - \int_a^b g'(x) f(x) \text{ by linearity} \\
        &= f(b) g(b) - f(a) g(a) - \int_a^b g'(x) f(x)\\
        &\text{ by corollary~\ref{corIntegrationInverseDifferentiation}}
    \end{align*}
\end{proof}
\begin{corollary}[Integration by Substitution]
    Let $g : [\alpha, \beta] \mapsto [a, b]$ with $g(\alpha) = a, g(\beta) = b$. Suppose also $g'$ exists and is continuous on $[\alpha, \beta]$.

    Let $f : [a, b] \mapsto \R$, and assume continuity. Then:
    \begin{equation*}
        \int_a^b f(x) dx = \int_\alpha^\beta f(g(t))g'(t) dt
    \end{equation*}
\end{corollary}
\begin{proof}
    Set $F(x) = \int_a^x f(t) dt$. Let $h(t) = F(g(t))$, which is well-defined as $g$ takes values in $[a, b]$.
    \begin{align*}
        \int_\alpha^\beta f(g(t)) g'(t) dt &= \int_\alpha^\beta F'(g(t)) g'(t) \text{ by theorem~\ref{thmFundamentalCalculusI}} \\
        &= \int_\alpha^\beta h'(t) dt \text{ by chain rule} \\
        &= h(\beta) - h(\alpha) \text{ by corollary~\ref{corIntegrationInverseDifferentiation}} \\
        &= F(b) - F(a) \\
        &= \int_a^b f(x) dx \text{ by corollary~\ref{corIntegrationInverseDifferentiation}.}
    \end{align*}
\end{proof}
\begin{remark}
    These two corollaries complete the toolbox of methods for integration.
\end{remark}
\section{Taylor's Theorem Revisited}
\begin{theorem}[Taylor's theorem with integral remainder]
    Suppose that $f$ and its first $n$ derivatives exist and are continuous for $x \in [0, h]$. Then:
    \begin{equation*}
        f(h) = f(0) + hf'(0) + \cdots + \frac{h^{n-1}f^{(n-1)}(0)}{(n-1)!} + R_n
    \end{equation*}
    where the remainder term is:
    \begin{equation*}
        R_n = \frac{h^n}{(n-1)!} \int_0^1 (1-t)^{n-1} f^{(n)}(th) dt
    \end{equation*}
    \label{thmTaylorsIII}
\end{theorem}
\begin{proof}
    \begin{align*}
        f(h) &= f(0) + \int_0^h f'(u) du \\
        &= f(0) + \int_0^h -\frac{d}{du}(h - u)f'(u) du \\
        &= f(0) + hf'(0) + \int_0^h (h - u) f''(u) du \text{ by integration by parts} \\
        &= f(0) + hf'(0) + \int_0^h \left(-\frac{d}{du} \frac{(h - u)^2}{2}\right)f''(u) du \\
        &= f(0) + hf'(0) + \frac{h^2 f''(0)}{2} + \int_0^h \frac{(h - u)^2}{2} f^{(3)}(u) du
    \end{align*}
    And it is clear that iterating this $n$ times gives:
    \begin{equation*}
        f(h) = f(0) + hf'(0) + \cdots + \frac{h^{n-1} f^{(n-1)}(0)}{(n-1)!} + \int_0^h \frac{(h - u)^{n-1}}{(n-1)!}f^{(n)}(u) du
    \end{equation*}
    Then setting $u = th$ in the remainder term gives the required result.
\end{proof}
\begin{remark}
    We assume here that the $n$th derivative is continuous. This is a stricter assumption than in previous versions (theorems \ref{thmTaylorsI} and \ref{thmTaylorsII}). However if we make this hypothesis, we can derive the other versions of Taylor's theorem from this one.
\end{remark}
\begin{theorem}
    Suppose that $f, g : [a, b] \mapsto \R$ are continuous and $g(x) \neq 0~\forall x \in (a, b)$. Then $\exists c \in (a, b)$ such that:
    \begin{equation*}
        \int_a^b f(x) g(x) dx = f(c)\int_a^b g(x) dx 
    \end{equation*}
    \label{thmIntegralMeanValue}
\end{theorem}
\begin{remark}
    Note that if $g(x) = 1$ then $\int_a^b f(x) dx = f(c)(b - a)$, which is that the average value (in the integrated sense) is equal a constant value $f(c)$.
\end{remark}
\begin{proof}
    Apply theorem~\ref{thmCauchyMeanValue} to:
    \begin{equation*}
        F(x) = \int_a^x f(x) g(x) dx~,~G(x) = \int_a^b g(x) dx
    \end{equation*}
    to deduce that:
    \begin{equation*}
        (F(b) - F(a))G'(c) = F'(c)(G(b) - G(a))
    \end{equation*}
    And therefore:
    \begin{equation*}
        \left(\int_a^b f(x) g(x) dx\right)g(c) = f(c) g(c) \left(\int_a^b f(x) dx\right)
    \end{equation*}
    And since $g$ is non-zero, we can cancel it for the result.
\end{proof}
Now consider:
\begin{equation*}
    R_n = \frac{h^n}{(n-1)!}\int_0^1 (1 - t)^{n-1} f^{(n)}(th) dt
\end{equation*}
Apply theorem~\ref{thmIntegralMeanValue} with $g = 1$ to get that there exists $\theta \in (0, 1)$ such that:
\begin{equation*}
    R_n = \frac{h^n}{(n-1)!}(1 - \theta)^{n-1} f^{(n)}(\theta h)
\end{equation*}
Alternatively, split the integrand such that $g(t) = (1 - t)^{(n-1)}$. Its integral on $[0, 1]$ is $\frac{1}{n}$.
Then the remainder becomes:
\begin{align*}
    R_n &= \frac{h^n}{(n-1)!}f^{(n)}(\theta h) \frac{1}{n} \\
    &= \frac{h^n}{n!}f^{(n)}(\theta h)
\end{align*}
\section{Improper Integrals}
The theory of integration we have developed so far applies to bounded functions on a bounded interval. For a full treatment of functions whose domain or image is unbounded, see Part II Probability and Measure.

The improper integral is a partial resolution to the cases of unbounded domain and unbounded image.
\subsection{Integrals on an Infinite Domain}
\begin{definition}{Integral on a half-line}
    Suppose $f : [a, \infty) \mapsto \R$ is integrable on $[a, R)~\forall R > a$. Assume also that:
    \begin{equation*}
        \int_a^R f(x) dx \to l \text{ as } R\to \infty
    \end{equation*}
    Then we say $\int_a^\infty$ \underline{exists} or \underline{converges}, and we set:
    \begin{equation*}
        \int_a^\infty f(x) dx = l
    \end{equation*}
\end{definition}
If $\int_a^R f(x) dx$ has no limit as $R \to \infty$, we say $\int_a^\infty$ \underline{diverges}. As with summation, this does not necessarily mean \textit{increases without bound}, it merely means it has no limit.

A similar definition can be used for the half-line $(-\infty, a]$.
\begin{definition}{Integral on the real line}
    For a function $f : \R \mapsto \R$ exists, and
    \begin{equation*}
        \int_{-\infty}^a f(x) dx = l_1 \text{ and } \int_a^\infty f(x) dx = l_2
    \end{equation*}
    then we say that $\int_{-\infty}^\infty f(x) dx$ \underline{exists} or \underline{converges}, and we set:
    \begin{equation*}
        \int_{-\infty}^a f(x) dx + \int_a^\infty f(x) dx
    \end{equation*}
\end{definition}
\subsection{Integrands With an Isolated Singularity}
\begin{definition}{Integral over an open left limit}
    Suppose $f : (b, c]$ is integrable on each $[b + \delta, c]~\forall \delta > 0$.
    Then if:
    \begin{equation*}
        \int_{b + \delta}^c f(x) dx \to l \text{ as } \delta \to \infty
    \end{equation*}
    we say that $\int_b^c f(x) dx$ \underline{exists} or \underline{converges} and is equal to $l$.
\end{definition}
\begin{remark}
    By theorem~\ref{propChangeFinitePointsIntegrable}, if $f : [b, c] \mapsto \R$ is integrable, the above definition gives the same answer as the proper integral.
\end{remark}
We define an integral over $f : [a, b) \mapsto \R$ similarly. If there exists a singularity in the middle of the integration domain, we split the integral on this singular point and use the corresponding definition for either side.
\subsection{Examples}
\begin{example}
    \begin{equation*}
        \int_1^\infty \frac{1}{x^k} dx \text{ converges if and only if } k > 1
    \end{equation*}
    also,
    \begin{equation*}
        \int_0^1 \frac{1}{x^k} dx \text{ converges if and only if } k < 1
    \end{equation*}
    To see this:
    \begin{align*}
        \int_1^R \frac{1}{x^k} dx &= \left[\frac{x^{1-k}}{1-k}\right]_1^R \\
        &= \frac{R^{1-k}-1}{1-k}
    \end{align*}
    Therefore this converges as $R \to \infty$ if $1 - k < 0$, and does not converge if $1 - k > 0$. Treating the case $k = 1$ separately:
    \begin{equation*}
        \int_1^R \frac{1}{x} dx = \left[\log(x)\right]_1^R = \log(R)
    \end{equation*}
    which also does not converge.
\end{example}
\begin{warning}
    We need to be careful:
    \begin{align*}
        \int_{-1}^{-\epsilon} \frac{1}{x} dx + \int_{\epsilon}^1 \frac{1}{x} dx &= -\int_\epsilon^1 \frac{1}{y} dy + \int_\epsilon^1 \frac{1}{x} dx \\
        &=0
    \end{align*}
    by a change of variables. However, this integral does not exist! Therefore, we need to be careful when integrating over a singularity like this as we can get incorrect results by ignoring it. Similarly,
    \begin{equation*}
        \int_{-R}^R x dx = 0 \text{ but } \int_{-\infty}^\infty x dx \text{ diverges.}
    \end{equation*} 
\end{warning}
\begin{lemma}
    Suppose $f, g : [0, \infty) \mapsto \R$ are integrable on $[0, R]~\forall R > 0$. If:
    \begin{equation*}
        0 \leq f(x) \leq g(x)
    \end{equation*}
    and:
    \begin{equation*}
        \int_0^\infty g(x) dx \text{ converges,}
    \end{equation*}
    then so does the integral of $f$ on this range, with the following bound:
    \begin{equation*}
        \int_0^\infty f(x) dx \leq \int_0^\infty g(x) dx
    \end{equation*}
    \label{lemIntegralComparisonTest}
\end{lemma}
\begin{proof}
    Since $f \geq 0$, $R \mapsto \int_0^R f(x) dx$ is increasing, and the same is true of $g$. Therefore:
    \begin{equation*}
        \int_0^R f(x) dx \leq \int_0^R g(x) \leq \int_0^\infty g(x) dx
    \end{equation*}
    Therefore the function $R \mapsto \int_0^R f(x) dx$ is increasing and bounded above. Define:
    \begin{equation*}
        l = \sup_{R > 0} \int_0^R f(x) dx
    \end{equation*}
    Then $l$ must be finite. We want to show that, in fact, it is the limit of the integral as $R$ tends to $\infty$.

    To see this, let $\epsilon > 0$. Then by the definition of the supremum, there must exist $\R_0$ such that:
    \begin{equation*}
        \int_0^{R_0} f(x) \geq l - \epsilon
    \end{equation*}
    Then since this integral is increasing in $R$, 
    \begin{equation*}
        l - \epsilon \int_0^{R_0} f(x) dx \leq \int_0^R f(x) dx \leq l
    \end{equation*}
    For any $R > R_0$, as required.
\end{proof}
\begin{example}
    Consider the integral:
    \begin{equation*}
        \int_0^{\infty} e^{-\frac{x^2}{2}} dx
    \end{equation*}
    Note that for $x > 1$, $\exp\left(-\frac{x^2}{2}\right) \leq \exp\left(-\frac{x}{2}\right)$.
    Then:
    \begin{align*}
        \int_1^R \exp{-\frac{x}{2}} &= \left[-2 \exp\left(-\frac{x}{2}\right)\right]_1^R \\
        &= 2e^{-\frac{1}{2}}
    \end{align*}
    And therefore by lemma~\ref{lemIntegralComparisonTest},
    \begin{equation*}
        \int_0^{\infty} e^{-\frac{x^2}{2}} dx
    \end{equation*}
    converges.
\end{example}
\begin{warning}
    Unlike with sums,
    \begin{equation*}
        \int_0^\infty f(x) dx \text{ converges } \nRightarrow f(x) \to 0 \text{ as } x \to 0
    \end{equation*}
\end{warning}
\begin{figure}[ht]
    \centering
    \begin{tikzpicture}[scale=2]
        \tikzset{
            axishatch/.pic={
                \draw (0, 0.1) -- (0, -0.1);
            }
        }
    
        \draw[->] (0, 0) -- (0, 1.1) node[above] {$f(x)$};
        \draw (0, 1) pic[rotate=90] {axishatch}
            node[anchor=east] {$1$};
            
        \draw[->] (0, 0) -- (3.7, 0) node[right] {$x$};

        \foreach \x/\xtext in {0.5/$\frac{1}{2}$,1/$1$,1.5/$\frac{3}{2}$,2/$2$,3/$n$}
            \draw (\x, 0) pic {axishatch}
            node[anchor=north] {\xtext};

        \draw (0, 0) -- (0.5, 0) -- (1, 1) -- (1.5, 0) -- (1.75, 0) -- (2, 1) -- (2.25, 0) -- (2.8, 0) -- (3, 1) -- (3.2, 0);

        \node at (2.5, 0.6) {$\cdots$};

        \draw[Bar-Bar] (2.8, -0.3) -- (3.2, -0.3)
            node[anchor=north, pos=0.5] {$2^{1-n}$};
        
    \end{tikzpicture}
    \caption{A piecewise-defined function with finite integral}
    \label{figFiniteIntegralNotToZero}
\end{figure}
\begin{example}[Counterexample for the above]
    Consider the function in figure~\ref{figFiniteIntegralNotToZero}. Then the integral looks like many areas of a triangle with height $1$ and width $2^{1-n}$.

    The area then is:
    \begin{equation*}
        \sum_{n = 1}^\infty 2^{-n} \text{ converges } \implies \int_0^\infty f(x) dx \text{ converges.}
    \end{equation*}
\end{example}
\end{document}
